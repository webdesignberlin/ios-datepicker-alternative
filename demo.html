<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <style>
        body { margin: 0; padding: 0; }
        .demo {
            background: coral;
            padding: 3%;
        }

        .date {

            --date-color-bg: #fff;
            --date-height: 300px;
            max-width: 80%;
            background-color: var(--date-color-bg);
        }

        .date-fields {
            display: grid;
            grid-template: var(--date-height) / 1fr 1fr 1fr;
            grid-gap: 1em;
        }

        .date-field {
            overflow: auto;
            -webkit-overflow-scrolling: touch;
            scroll-snap-type: mandatory;
            /* older spec implementation */
            scroll-snap-destination: 0% 100%;
            scroll-snap-points-x: repeat(100%);
        }


        /* Demo Styles */

        .date {
            --theme-spacing: 1em;
        }

        .date-list {
            margin: 0;
            padding: 0;
            list-style: none;
        }

        .date-list__item {
            padding: 0;
            margin: 0;
        }

        .date-field__item {
            font-size: 16px;
            display: block;
            width: 100%;
            padding: var(--theme-spacing);
            margin: calc(var(--theme-spacing) / 2) 0;
            line-height: 1.2;
            text-align: center;
            vertical-align: middle;
            touch-action: manipulation;
            cursor: pointer;
            background-image: none;
            background: none;
            user-select: none;
            text-decoration: none;
            border-radius: 0;
            border: 0;
        }

        .date-field__item--active {
            background: cornflowerblue;
            color: white;
        }

        .date-fields {
            grid-gap: 0;
        }
    </style>

</head>
<body>
<div class="demo">
    <input type="date" class="date-trigger">
    <div id="date-wrapper"></div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/nunjucks/3.0.0/nunjucks.min.js"></script>

<script>
  function generateYears(startYear = 1984) {
    let currentYear = new Date().getFullYear(), years = [];

    while ( startYear <= currentYear ) {
      years.push(startYear++);
    }

    return years;
  }


  let templateOptions = {
    years: generateYears(new Date().getFullYear() - 100),
    months: ['01','02','03','04','05','06','07','08','09','10','11','12'],
    days: ['01','02','03','04','05','06','07','08','09','10','11','12','13','14','15','16','17','18','19','20','21','22','23','24','25','26','27','28','29','30','31'],
    foo: 'works'
  };

  console.log(generateYears(new Date().getFullYear() - 100));
  nunjucks.configure('views', { autoescape: true });
  let dateTemplate = nunjucks.render('/_date-form-template.nunjucks', templateOptions);
  let elTarget = document.getElementById('date-wrapper');
  function dateMarkup() {
    elTarget.insertAdjacentHTML('beforeend', dateTemplate);
  }

  dateMarkup();

</script>


<script>

  function initDay(datePicker) {
    let _elsDay = datePicker._elsDay;
    for (let fieldItem of _elsDay){
      fieldItem.addEventListener('click', function () {
        let value = fieldItem.dataset.dateValue;
        datePicker.setDay(value)
      });
    }
  }

  function initMonth(datePicker) {
    let _elsMonth = datePicker._elsMonth;
    for (let fieldItem of _elsMonth){
      fieldItem.addEventListener('click', function () {
        let value = fieldItem.dataset.dateValue;
        datePicker.setMonth(value)
      });
    }
  }

  function initYear(datePicker) {
    let _elsYear = datePicker._elsYear;
    for (let fieldItem of _elsYear){
      fieldItem.addEventListener('click', function () {
        let value = fieldItem.dataset.dateValue;
        datePicker.setYear(value)
      });
    }
  }

  class datePicker {
    constructor(dateInput){
      this._elDateInput = dateInput;
      this._elWrapper = document.querySelector('.date');
      this._elDayWrapper = this._elWrapper.querySelectorAll('.date-field--day')[0];
      this._elsDay = this._elDayWrapper.querySelectorAll('.date-field__item');
      this._elMonthWrapper = this._elWrapper.querySelectorAll('.date-field--month')[0];
      this._elsMonth = this._elMonthWrapper.querySelectorAll('.date-field__item');
      this._elYearWrapper = this._elWrapper.querySelectorAll('.date-field--year')[0];
      this._elsYear = this._elYearWrapper.querySelectorAll('.date-field__item');
      this.enteredDate = {
        year: '',
        month: '',
        day: ''
      };
    }

    setDay(day){
      console.log('setDay',day);
      let datePicker = this;
      let elsDayItems = datePicker._elsDay;
      let elActiveDay = datePicker._elDayWrapper.querySelectorAll(`[data-date-value="${day}"]`)[0];

      for (let elsDayItem of elsDayItems) {
        elsDayItem.classList.remove('date-field__item--active')
      }
      elActiveDay.classList.add('date-field__item--active');
      datePicker.enteredDate.day = day;
      datePicker.returnDate();
    }

      /*getDay(){
       let datePicker = this;
       let elActiveDay = datePicker._elDayWrapper.querySelectorAll(`.date-field__item--active`)[0];
       console.log('getDay', elActiveDay.dataset.dateValue);
       console.log(datePicker.enteredDate);
       //return elActiveDay.dataset.dateValue;
       }*/

    setMonth(month){
      console.log('setMonth',month);
      let datePicker = this;
      let elsMonthItems = datePicker._elsMonth;
      let elActiveMonth = datePicker._elMonthWrapper.querySelectorAll(`[data-date-value="${month}"]`)[0];

      for (let elMonthItem of elsMonthItems) {
        elMonthItem.classList.remove('date-field__item--active')
      }
      elActiveMonth.classList.add('date-field__item--active');
      datePicker.enteredDate.month = month;
      datePicker.returnDate();
    }

    setYear(year, scrollToActive = false){
      console.log('setYear',year);
      let datePicker = this;
      let elsYearItems = datePicker._elsYear;
      let elActiveYear = datePicker._elYearWrapper.querySelectorAll(`[data-date-value="${year}"]`)[0];

      for (let elYearItem of elsYearItems) {
        elYearItem.classList.remove('date-field__item--active')
      }
      elActiveYear.classList.add('date-field__item--active');

      if(scrollToActive === true) {
        console.log(elActiveYear.scrollTop);
        //elActiveYear.scrollIntoView(false);
        const elementRect = elActiveYear.getBoundingClientRect();
        const container = datePicker._elYearWrapper;
        // const absoluteElementTop = elementRect.top + container.scrollTop;
        const absoluteElementTop = elActiveYear.offsetTop + container.scrollTop;
        const middle = absoluteElementTop - (container.offsetHeight / 2);
        container.scrollTop = middle;
        console.log(middle);
      }

      datePicker.enteredDate.year = year;
      datePicker.returnDate();
    }

    returnDate(){
      let datePicker = this;
        /*let checkDate = [
         datePicker.enteredDate.year,
         datePicker.enteredDate.month,
         datePicker.enteredDate.day
         ];*/
      let checkDate = datePicker.enteredDate.year + '-' + datePicker.enteredDate.month + '-' + datePicker.enteredDate.day;

      if (checkDate.match(/^(\d{4})\-(\d{1,2})\-(\d{1,2})$/)) {
        console.log(checkDate);
        this._elDateInput.value = datePicker.enteredDate.year + '-' + datePicker.enteredDate.month + '-' + datePicker.enteredDate.day;
      }
        /*console.log(moment(checkDate).isValid());
         if (moment(checkDate).isValid() === true) {
         this._elDateInput.value = moment(checkDate).format('YYYY-MM-DD');
         }*/
    }

    init(){
      let datePicker = this;
      initDay(datePicker);
      initMonth(datePicker);
      initYear(datePicker);
    }

  }

  /*demo.setDay('11');
   demo.setMonth('08');
   demo.setYear('0007');*/
  let elDatePicker = document.querySelector('.date-trigger');
  let demo = new datePicker(elDatePicker);
  demo.setYear('1984', true);
  demo.init();
</script>
<script id="__bs_script__">//<![CDATA[
document.write("<script async src='http://HOST:3002/browser-sync/browser-sync-client.js?v=2.18.8'><\/script>".replace("HOST", location.hostname));
//]]></script>
</body>
</html>